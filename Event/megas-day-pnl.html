<!DOCTYPE html>
<html>
<head>
Â  <base target="_top">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  <title>Admin Panel - Mega's Day</title>
Â  
Â  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
Â  
Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
Â  
Â  <style>
Â  Â  /* --- RED THEME VARIABLES --- */
Â  Â  :root {
Â  Â  Â  --primary: #ff0033; Â  Â  Â  Â  
Â  Â  Â  --primary-dark: #b30024;
Â  Â  Â  --text-white: #ffffff;
Â  Â  Â  --text-muted: #b0b0b0;
Â  Â  Â  
Â  Â  Â  --glass-bg: rgba(20, 20, 20, 0.70);
Â  Â  Â  --glass-border: rgba(255, 255, 255, 0.1);
Â  Â  Â  --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.7);
Â  Â  Â  --blur-amt: 12px;
Â  Â  Â  
Â  Â  Â  --header-h: 70px;
Â  Â  Â  --nav-h: 70px;
Â  Â  Â  --z-header: 1000;
Â  Â  Â  --z-nav: 1000;
Â  Â  Â  --z-bg: -1;
Â  Â  }
Â  Â  
Â  Â  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
Â  Â  
Â  Â  body {
Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  Â  color: var(--text-white);
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  padding-top: calc(var(--header-h) + 25px);
Â  Â  Â  padding-bottom: calc(var(--nav-h) + 30px);
Â  Â  Â  min-height: 100vh;
Â  Â  Â  background-color: var(--bg-dark);
Â  Â  Â  position: relative;
Â  Â  }

Â  Â  /* BACKGROUND BLUR IMPLEMENTATION */
Â  Â  body::before {
Â  Â  Â  content: '';
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0; left: 0;
Â  Â  Â  width: 100%; height: 100%;
Â  Â  Â  z-index: var(--z-bg); 
Â  Â  Â  background: url('https://www.dimsprat.site/Assets/images/Background.webp') no-repeat center center;
Â  Â  Â  background-size: cover;
Â  Â  Â  filter: blur(3px) brightness(0.4); 
Â  Â  Â  transform: scale(1.05); 
Â  Â  Â  pointer-events: none;
Â  Â  }

Â  Â  /* --- 1. HEADER (Fixed Glass) --- */
Â  Â  .app-header {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0; left: 0; width: 100%;
Â  Â  Â  height: var(--header-h);
Â  Â  Â  background: rgba(0, 0, 0, 0.5);
Â  Â  Â  backdrop-filter: blur(15px);
Â  Â  Â  -webkit-backdrop-filter: blur(15px);
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  z-index: var(--z-header);
Â  Â  Â  border-bottom: 1px solid var(--glass-border);
Â  Â  Â  box-shadow: 0 4px 15px rgba(0,0,0,0.4);
Â  Â  }
Â  Â  
Â  Â  .header-logo-img {
Â  Â  Â  height: 38px; width: auto;
Â  Â  Â  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
Â  Â  }

Â  Â  /* --- 2. CONTAINER & CARD --- */
Â  Â  .container {
Â  Â  Â  padding: 0 20px;
Â  Â  Â  max-width: 480px;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  display: none;
Â  Â  Â  animation: fadeInUp 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
Â  Â  }
Â  Â  .container.active { display: block; }

Â  Â  @keyframes fadeInUp {
Â  Â  Â  from { opacity: 0; transform: translateY(20px); }
Â  Â  Â  to { opacity: 1; transform: translateY(0); }
Â  Â  }

Â  Â  .card {
Â  Â  Â  background: var(--glass-bg);
Â  Â  Â  backdrop-filter: blur(var(--blur-amt));
Â  Â  Â  -webkit-backdrop-filter: blur(var(--blur-amt));
Â  Â  Â  border: 1px solid var(--glass-border);
Â  Â  Â  border-radius: 24px;
Â  Â  Â  padding: 30px 25px;
Â  Â  Â  box-shadow: var(--glass-shadow);
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  h2 {
Â  Â  Â  margin: 0 0 25px 0;
Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  font-weight: 600;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  letter-spacing: 1.5px;
Â  Â  Â  color: var(--primary);
Â  Â  Â  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
Â  Â  Â  padding-bottom: 15px;
Â  Â  }

Â  Â  /* --- 3. FORMS & BUTTONS --- */
Â  Â  .input-wrapper { margin-bottom: 25px; }
Â  Â  
Â  Â  input[type="text"] {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 16px 20px;
Â  Â  Â  background: rgba(0, 0, 0, 0.5);
Â  Â  Â  border: 1px solid var(--glass-border);
Â  Â  Â  border-radius: 12px;
Â  Â  Â  color: var(--text-white);
Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  Â  font-size: 1rem;
Â  Â  Â  outline: none;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â  
Â  Â  input[type="text"]:focus {
Â  Â  Â  border-color: var(--primary);
Â  Â  Â  box-shadow: 0 0 15px rgba(255, 0, 51, 0.3);
Â  Â  Â  background: rgba(0, 0, 0, 0.7);
Â  Â  }

Â  Â  button {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 16px;
Â  Â  Â  border-radius: 50px;
Â  Â  Â  border: none;
Â  Â  Â  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
Â  Â  Â  color: var(--text-white);
Â  Â  Â  font-weight: 700;
Â  Â  Â  font-size: 0.95rem;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  letter-spacing: 1px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  box-shadow: 0 8px 20px rgba(255, 0, 51, 0.25);
Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  Â  transition: transform 0.2s, box-shadow 0.3s;
Â  Â  }
Â  Â  button:active { transform: scale(0.97); }
Â  Â  button:hover { box-shadow: 0 10px 25px rgba(255, 0, 51, 0.4); }

Â  Â  /* Result Area */
Â  Â  #result-area {
Â  Â  Â  margin-top: 25px;
Â  Â  Â  background: rgba(0,0,0,0.4);
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  border: 1px dashed rgba(255, 0, 51, 0.3);
Â  Â  Â  display: none;
Â  Â  }
Â  Â  
Â  Â  .link-display {
Â  Â  Â  width: 100%; background: transparent; border: none;
Â  Â  Â  color: var(--primary); font-size: 0.85rem; text-align: center;
Â  Â  Â  margin: 10px 0; font-family: monospace; font-weight: bold;
Â  Â  }

Â  Â  .btn-secondary {
Â  Â  Â  background: rgba(255,255,255,0.08) !important;
Â  Â  Â  border: 1px solid rgba(255,255,255,0.1) !important;
Â  Â  Â  box-shadow: none !important;
Â  Â  Â  margin-top: 10px; font-size: 0.85rem !important; padding: 12px !important;
Â  Â  Â  color: var(--text-muted) !important;
Â  Â  }
Â  Â  .btn-secondary:hover { color: var(--text-white) !important; border-color: var(--text-white) !important;}

Â  Â  /* --- 4. SCANNER UI --- */
Â  Â  #reader {
Â  Â  Â  width: 100%; border-radius: 16px; overflow: hidden;
Â  Â  Â  border: 2px solid #333; background: #000;
Â  Â  Â  box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
Â  Â  }
Â  Â  #scan-result {
Â  Â  Â  margin-top: 20px; padding: 15px; border-radius: 10px;
Â  Â  Â  background: rgba(255,255,255,0.05); font-size: 0.9rem; color: var(--text-muted);
Â  Â  Â  border: 1px solid var(--glass-border);
Â  Â  }

Â  Â  /* --- 5. HISTORY LIST --- */
Â  Â  .history-header {
Â  Â  Â  display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
Â  Â  }

Â  Â  .history-item {
Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  padding: 15px 20px; margin-bottom: 12px;
Â  Â  Â  background: rgba(30, 30, 30, 0.6);
Â  Â  Â  border-radius: 12px;
Â  Â  Â  border-left: 4px solid #444;
Â  Â  Â  transition: transform 0.2s, background 0.2s;
Â  Â  }
Â  Â  .history-item:hover { transform: translateX(5px); background: rgba(40, 40, 40, 0.8);}
Â  Â  
Â  Â  .history-item.success { border-left-color: #4caf50; }
Â  Â  .history-item.fail { border-left-color: var(--primary); }

Â  Â  .h-info { text-align: left; }
Â  Â  .h-name { font-weight: 600; font-size: 1rem; color: var(--text-white); display: block; margin-bottom: 4px;}
Â  Â  .h-time { font-size: 0.75rem; color: var(--text-muted); }
Â  Â  .h-badge { font-size: 0.7rem; font-weight: 700; padding: 5px 10px; border-radius: 20px; background: rgba(255,255,255,0.08); color: var(--text-muted); letter-spacing: 0.5px; }

Â  Â  /* --- 6. FLOATING NAVIGATION --- */
Â  Â  .nav {
Â  Â  Â  position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
Â  Â  Â  width: 90%; max-width: 360px; height: var(--nav-h);
Â  Â  Â  background: rgba(15, 15, 15, 0.85);
Â  Â  Â  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
Â  Â  Â  border-radius: 35px;
Â  Â  Â  display: flex; justify-content: space-evenly; align-items: center;
Â  Â  Â  border: 1px solid rgba(255, 0, 51, 0.1);
Â  Â  Â  box-shadow: 0 10px 30px rgba(0,0,0,0.8);
Â  Â  Â  z-index: var(--z-nav);
Â  Â  }

Â  Â  .nav-item {
Â  Â  Â  display: flex; flex-direction: column; align-items: center; justify-content: center;
Â  Â  Â  color: #666; cursor: pointer; width: 70px; height: 100%;
Â  Â  Â  transition: all 0.3s ease; position: relative;
Â  Â  }

Â  Â  .nav-icon { font-size: 1.5rem; margin-bottom: 2px; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
Â  Â  .nav-text { font-size: 0.65rem; font-weight: 600; opacity: 0; transform: translateY(10px); transition: all 0.3s; position: absolute; bottom: 12px; color: var(--primary); letter-spacing: 1px;}

Â  Â  /* Active State */
Â  Â  .nav-item.active { color: var(--primary); }
Â  Â  .nav-item.active .nav-icon { transform: translateY(-10px) scale(1.1); filter: drop-shadow(0 0 8px var(--primary)); }
Â  Â  .nav-item.active .nav-text { opacity: 1; transform: translateY(0); }
Â  Â  
Â  Â  /* Red Dot Indicator */
Â  Â  .nav-item.active::after {
Â  Â  Â  content: ''; position: absolute; top: 15px;
Â  Â  Â  width: 6px; height: 6px; background: var(--primary);
Â  Â  Â  border-radius: 50%; box-shadow: 0 0 8px var(--primary);
Â  Â  }

Â  </style>
</head>
<body>

Â  <header class="app-header">
Â  Â  <img src="https://www.dimsprat.site/Assets/images/logo.png" alt="Dimsprat" class="header-logo-img">
Â  </header>

Â  <div id="add-guest" class="container active">
Â  Â  <div class="card">
Â  Â  Â  <h2>Buat Undangan Baru</h2>
Â  Â  Â  <div class="input-wrapper">
Â  Â  Â  Â  <input type="text" id="namaTamu" placeholder="Ketik Nama Tamu..." autocomplete="off">
Â  Â  Â  </div>
Â  Â  Â  <button onclick="addGuest()">Generate Link</button>
Â  Â  Â  
Â  Â  Â  <div id="result-area">
Â  Â  Â  Â  <div id="result-msg" style="font-size:0.9rem; margin-bottom:15px; font-weight:600;"></div>
Â  Â  Â  Â  <input type="text" id="result-link" class="link-display" readonly onclick="this.select()">
Â  Â  Â  Â  <button onclick="copyLink()" class="btn-secondary">Salin Link WhatsApp</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div id="scan-qr" class="container">
Â  Â  <div class="card">
Â  Â  Â  <h2>Scan Check-in</h2>
Â  Â  Â  <div id="reader"></div>
Â  Â  Â  <div id="scan-result">Siap memindai QR Code...</div>
Â  Â  </div>
Â  Â  <button onclick="startScanner()" class="btn-secondary" style="margin-top:20px;">Restart Scanner</button>
Â  </div>

Â  <div id="history" class="container">
Â  Â  <div class="history-header">
Â  Â  Â  <h2 style="margin:0; border:none; padding:0; color:#fff; font-size:1.2rem;">Live History</h2>
Â  Â  Â  <button onclick="loadHistory()" class="btn-secondary" style="width:auto !important; padding:10px 20px !important; margin:0 !important;">Refresh</button>
Â  Â  </div>
Â  Â  
Â  Â  <div id="history-list">
Â  Â  Â  <div style="text-align:center; color:#666; margin-top:80px; font-style:italic;">Memuat data...</div>
Â  Â  </div>
Â  </div>

Â  <nav class="nav">
Â  Â  <div class="nav-item active" onclick="showTab('add-guest', this)">
Â  Â  Â  <div class="nav-icon">âœ¨</div>
Â  Â  Â  <div class="nav-text">Input</div>
Â  Â  </div>
Â  Â  <div class="nav-item" onclick="showTab('scan-qr', this)">
Â  Â  Â  <div class="nav-icon">ğŸ“·</div>
Â  Â  Â  <div class="nav-text">Scan</div>
Â  Â  Â  Â  Â  </div>
Â  Â  <div class="nav-item" onclick="showTab('history', this)">
Â  Â  Â  <div class="nav-icon">ğŸ“œ</div>
Â  Â  Â  <div class="nav-text">History</div>
Â  Â  </div>
Â  </nav>

Â  <script>
    // URL Google Apps Script Anda
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxmbThfejeyRXhXHkkL4npo4EpIthqXr2q-vr7yBRPqIB6VNshgj2C0WEABxbJrjrp8/exec';

    // Helper function untuk mengirim permintaan POST ke Apps Script API
    async function sendRequest(action, data) {
        const url = `${APPS_SCRIPT_URL}?action=${action}`;
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain;charset=utf-8', // Penting untuk doPost Apps Script
            },
            body: JSON.stringify(data),
            mode: 'cors'
        });

        if (!response.ok) {
            throw new Error(`Permintaan HTTP gagal! Status: ${response.status}`);
        }
        return response.json();
    }
    
Â  Â  // --- NAVIGASI ---
Â  Â  function showTab(tabId, navElement) {
Â  Â  Â  const containers = document.querySelectorAll('.container');
Â  Â  Â  const navItems = document.querySelectorAll('.nav-item');
Â  Â  Â  
Â  Â  Â  containers.forEach(el => el.classList.remove('active'));
Â  Â  Â  navItems.forEach(el => el.classList.remove('active'));
Â  Â  Â  
Â  Â  Â  document.getElementById(tabId).classList.add('active');
Â  Â  Â  if (navElement) {
Â  Â  Â  Â  navElement.classList.add('active');
Â  Â  Â  } else {
Â  Â  Â  Â  document.querySelector(`.nav-item[onclick*="${tabId}"]`).classList.add('active');
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  if(tabId === 'scan-qr') startScanner();
Â  Â  Â  else stopScanner();
Â  Â  Â  
Â  Â  Â  if(tabId === 'history') loadHistory();
Â  Â  }
Â  Â  
Â  Â  // Panggil showTab untuk tab default saat halaman dimuat
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  // Gunakan querySelector untuk memastikan elemen default aktif
Â  Â  Â  showTab('add-guest', document.querySelector('.nav-item.active'));
Â  Â  });


Â  Â  // --- ADD GUEST (FIXED STUCK PROCESSING) ---
Â  Â  function addGuest() {
Â  Â  Â  const namaInput = document.getElementById('namaTamu');
Â  Â  Â  const nama = namaInput.value.trim();
Â  Â  Â  
Â  Â  Â  if(!nama) return alert("Nama wajib diisi!");
Â  Â  Â  
Â  Â  Â  const btn = document.querySelector('#add-guest button:not(.btn-secondary)');
Â  Â  Â  const originalText = btn.innerText;
Â  Â  Â  
Â  Â  Â  btn.innerText = "Processing...";
Â  Â  Â  btn.disabled = true;
Â  Â  Â  
Â  Â  Â  const successHandler = (res) => {
Â  Â  Â  Â  btn.innerText = originalText;
Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  
Â  Â  Â  Â  const area = document.getElementById('result-area');
Â  Â  Â  Â  const msgBox = document.getElementById('result-msg');
Â  Â  Â  Â  const linkBox = document.getElementById('result-link');
Â  Â  Â  Â  
Â  Â  Â  Â  area.style.display = 'block';
Â  Â  Â  Â  msgBox.innerText = res.msg;
Â  Â  Â  Â  linkBox.value = res.link;
Â  Â  Â  Â  
Â  Â  Â  Â  if(res.success) { 
Â  Â  Â  Â  Â  Â  msgBox.style.color = '#4caf50';
Â  Â  Â  Â  Â  Â  namaInput.value = ''; 
Â  Â  Â  Â  } else { 
Â  Â  Â  Â  Â  Â  msgBox.style.color = '#ff0033';
Â  Â  Â  Â  }
Â  Â  Â  };
Â  Â  Â  
Â  Â  Â  const failureHandler = (error) => {
Â  Â  Â  Â  btn.innerText = originalText;
Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  
Â  Â  Â  Â  const area = document.getElementById('result-area');
Â  Â  Â  Â  const msgBox = document.getElementById('result-msg');
Â  Â  Â  Â  
Â  Â  Â  Â  area.style.display = 'block';
Â  Â  Â  Â  msgBox.innerText = `ERROR KOMUNIKASI: Gagal terhubung ke server. (${error.message})`;
Â  Â  Â  Â  msgBox.style.color = '#ff0033';
Â  Â  Â  Â  document.getElementById('result-link').value = '---';
Â  Â  Â  };
Â  Â  Â  
Â  Â  Â  // Mengganti google.script.run dengan sendRequest
Â  Â  Â  sendRequest('addGuest', { nama: nama })
        .then(successHandler)
        .catch(failureHandler);
Â  Â  }

Â  Â  function copyLink() {
Â  Â  Â  const copyText = document.getElementById("result-link");
Â  Â  Â  copyText.select();
Â  Â  Â  copyText.setSelectionRange(0, 99999);
Â  Â  Â  
Â  Â  Â  try {
Â  Â  Â  Â  Â  document.execCommand("copy");
Â  Â  Â  Â  Â  const btn = document.querySelector('#result-area .btn-secondary');
Â  Â  Â  Â  Â  const originalText = btn.innerText;
Â  Â  Â  Â  Â  btn.innerText = "Tersalin! âœ…";
Â  Â  Â  Â  Â  setTimeout(() => btn.innerText = originalText, 2000);
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  alert("Gagal menyalin link otomatis.");
Â  Â  Â  }
Â  Â  }

Â  Â  // --- SCANNER LOGIC ---
Â  Â  let html5QrcodeScanner = null;
Â  Â  
Â  Â  function startScanner() {
Â  Â  Â  if(html5QrcodeScanner) return; 
Â  Â  Â  
Â  Â  Â  // Reset hasil scan
Â  Â  Â  document.getElementById('scan-result').innerHTML = "Siap memindai QR Code...";
Â  Â  Â  
Â  Â  Â  html5QrcodeScanner = new Html5QrcodeScanner("reader", { 
Â  Â  Â  Â  Â  fps: 10, 
Â  Â  Â  Â  Â  qrbox: { width: 250, height: 250 },
Â  Â  Â  Â  Â  aspectRatio: 1.0,
Â  Â  Â  Â  Â  showTorchButtonIfSupported: true,
Â  Â  Â  Â  Â  rememberLastUsedCamera: true
Â  Â  Â  });
Â  Â  Â  html5QrcodeScanner.render(onScanSuccess, onScanFailure);
Â  Â  }
Â  Â  
Â  Â  function stopScanner() {
Â  Â  Â  if(html5QrcodeScanner) {
Â  Â  Â  Â  html5QrcodeScanner.clear().then(() => {
Â  Â  Â  Â  Â  html5QrcodeScanner = null;
Â  Â  Â  Â  }).catch(e => {
Â  Â  Â  Â  Â  console.error("Scanner clear error:", e);
Â  Â  Â  Â  Â  html5QrcodeScanner = null; 
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  }

Â  Â  function onScanSuccess(decodedText, decodedResult) {
Â  Â  Â  stopScanner(); 
Â  Â  Â  
Â  Â  Â  const resBox = document.getElementById('scan-result');
Â  Â  Â  resBox.innerHTML = '<span style="color:var(--primary)">â³ Verifikasi Data...</span>';
Â  Â  Â  
Â  Â  Â  const handleScanResult = (resObj) => {
          const res = resObj.msg; // Ambil pesan dari properti 'msg'
Â  Â  Â  Â  Â  const isSuccess = res.includes("SUKSES");
Â  Â  Â  Â  Â  const color = isSuccess ? "#4caf50" : "#ff0033"; 
Â  Â  Â  Â  Â  const icon = isSuccess ? "âœ…" : "âš ï¸";
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  resBox.innerHTML = `<span style="color:${color}; font-weight:700; font-size:1.1rem;">${icon} ${res}</span>`;
Â  Â  Â  Â  
Â  Â  Â  Â  Â  setTimeout(() => { 
Â  Â  Â  Â  Â  Â  Â  startScanner(); 
Â  Â  Â  Â  Â  Â  Â  resBox.innerHTML = "Siap memindai...";
Â  Â  Â  Â  Â  Â  Â  resBox.style.color = "#ccc";
Â  Â  Â  Â  Â  }, 3500);
Â  Â  Â  };
      
      const handleScanFailure = (error) => {
        resBox.innerHTML = `<span style="color:#ff0033; font-weight:700;">âŒ Error Server: ${error.message}</span>`;
        setTimeout(() => { startScanner(); }, 3500);
      };

Â  Â  Â  // Mengganti google.script.run dengan sendRequest
Â  Â  Â  sendRequest('scanQR', { scanContent: decodedText })
          .then(handleScanResult)
          .catch(handleScanFailure);
Â  Â  }
Â  Â  
Â  Â  function onScanFailure(error) {
Â  Â  }

Â  Â  // --- HISTORY LOGIC ---
Â  Â  function loadHistory() {
Â  Â  Â  const listContainer = document.getElementById('history-list');
Â  Â  Â  listContainer.innerHTML = '<div style="text-align:center; color:#666; margin-top:80px;">Memuat data terbaru...</div>';
Â  Â  Â  
      const handleHistorySuccess = (res) => {
        const data = res.data || [];
Â  Â  Â  Â  listContainer.innerHTML = "";
Â  Â  Â  Â  
Â  Â  Â  Â  if (data.length === 0) {
Â  Â  Â  Â  Â  listContainer.innerHTML = '<div style="text-align:center; padding:50px; color:#555; font-style:italic;">Belum ada riwayat scan.</div>';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  const fragment = document.createDocumentFragment();
Â  Â  Â  Â  
Â  Â  Â  Â  data.forEach((row) => {
Â  Â  Â  Â  Â  // Row[0] adalah timestamp dari Apps Script (dalam milliseconds jika POST)
Â  Â  Â  Â  Â  let date = new Date(row[0]);
Â  Â  Â  Â  Â  // Fallback jika date tidak valid atau row[0] null
          if (!(date instanceof Date && !isNaN(date))) {
              // Jika data datang sebagai string ISO, coba parse lagi
              if (typeof row[0] === 'string') {
                  date = new Date(row[0]);
              }
          }
          
Â  Â  Â  Â  Â  const timeStr = date instanceof Date && !isNaN(date) ? date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }).replace('.', ':') : 'N/A';
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  const status = row[2] || "BELUM HADIR";
Â  Â  Â  Â  Â  const isSuccess = status.includes("SUKSES CHECK-IN") || status === "HADIR";
Â  Â  Â  Â  Â  const statusClass = isSuccess ? "success" : "fail"; 
Â  Â  Â  Â  Â  const statusText = isSuccess ? "CHECK-IN" : "BELUM HADIR";
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  Â  itemDiv.className = `history-item ${statusClass}`;
Â  Â  Â  Â  Â  itemDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  <div class="h-info">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="h-name">${row[1] || 'Nama Tamu Kosong'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="h-time">${timeStr} WIB</span>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <span class="h-badge">${statusText}</span>
Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  fragment.appendChild(itemDiv);
Â  Â  Â  Â  });
Â  Â  Â  Â  
Â  Â  Â  Â  listContainer.appendChild(fragment);
      };
      
      const handleHistoryFailure = (error) => {
        listContainer.innerHTML = `<div style="text-align:center; padding:50px; color:var(--primary); font-style:italic;">Gagal memuat riwayat: ${error.message}</div>`;
      };
Â  Â  Â  
Â  Â  Â  // Mengganti google.script.run dengan sendRequest
Â  Â  Â  sendRequest('getHistory', {})
          .then(handleHistorySuccess)
          .catch(handleHistoryFailure);
Â  Â  }
Â  </script>
</body>
</html>
